<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tap Game ‚Äì New Year Edition</title>

<style>
*{box-sizing:border-box;touch-action:manipulation;}
body{
  margin:0;padding:0;display:flex;flex-direction:column;justify-content:center;align-items:center;
  font-family:"Comic Sans MS";color:#fff;height:100dvh;overflow:hidden;
  background:#000 center/cover no-repeat;
  -webkit-tap-highlight-color:transparent;
}

/*********** UI ***********/
#topWrap{display:flex;flex-direction:column;align-items:center;gap:4px;margin-bottom:6px;}
#message{
  min-height:52px;display:flex;align-items:center;justify-content:center;
  font-size:1.25rem;text-align:center;transition:.25s;
}
.progress-wrap{
  width:65vw;max-width:400px;height:8px;background:rgba(255,255,255,.25);
  border-radius:20px;overflow:hidden;transition:.25s;
}
.progress{height:100%;width:0;background:#FFD700;transition:width .22s linear;}

#slot{
  width:100%;display:flex;justify-content:center;align-items:center;
  height:280px;position:relative;
}
#btn,#gift{
  width:75vw;max-width:360px;position:absolute;
  user-select:none;will-change:transform,opacity;
}
#gift{
  opacity:0;transform:scale(.75);pointer-events:none;
  transition:.25s ease;border-radius:12px;
}
#btn{
  cursor:pointer;transition:transform .12s ease;
  outline:none;border:none;-webkit-tap-highlight-color:transparent;
}
#btn:active{transform:scale(1.05);}

#confirmBox{
  position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(.85);
  background:rgba(0,0,0,.92);padding:22px;border-radius:16px;text-align:center;
  color:#fff;opacity:0;pointer-events:none;backdrop-filter:blur(6px);transition:.28s;
}
#confirmBox.show{opacity:1;pointer-events:auto;transform:translate(-50%,-50%) scale(1);}

.confirm-btn{
  padding:10px 25px;border:none;border-radius:12px;font-size:1rem;
  margin:6px;font-weight:bold;cursor:pointer;transition:.2s;
}
#sellBtn{background:#0092ff;color:#fff;}
#receiveBtn{background:#FFD800;color:#222;}
.confirm-btn:active{transform:scale(.92);} 

@keyframes tapPop{
  0%{transform:scale(1);}50%{transform:scale(1.12);}100%{transform:scale(1);}
}

/*********** –°–ù–ï–ì–û–ü–ê–î ***********/
.snowflake{
  position:fixed;top:-20px;color:white;user-select:none;pointer-events:none;
  font-size:18px;animation:fall linear forwards;
}
@keyframes fall{
  to{transform:translateY(120vh) rotate(360deg);}
}

/*********** –°–£–ì–†–û–ë–´ ***********/
#snowdrift{
  position:fixed;
  bottom:0;left:0;
  width:100%;
  height:0;
  background:linear-gradient(to top, #ffffff, #f6f6f6);
  pointer-events:none;
  z-index:5;
  overflow:hidden;
  transition:height 1s ease-out;
  animation:snowWiggle 6s ease-in-out infinite;
}

/* –ª–µ–≥–∫–æ–µ –ø–æ–∫–∞—á–∏–≤–∞–Ω–∏–µ */
@keyframes snowWiggle{
  0%,100%{transform:translateY(0);}
  50%{transform:translateY(-1.5px);}
}

/* –≤–æ–ª–Ω–∞ */
#snowdrift::before{
  content:"";
  position:absolute;
  top:-28px;
  left:0;
  width:100%;
  height:62px;
  background:url('data:image/svg+xml;utf8,\
  <svg xmlns="http://www.w3.org/2000/svg" width="300" height="62">\
    <path d="M0 40 Q25 10 60 38 T140 34 T220 40 T300 32 V65 H0 Z" fill=\'white\'/>\
  </svg>') repeat-x;
  background-size:300px 62px;
}

/* –º—è–≥–∫–∏–π —Å–≤–µ—Ç —Å–≤–µ—Ä—Ö—É */
#snowdrift::after{
  content:"";
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:40px;
  background:linear-gradient(to bottom, rgba(255,255,255,0.85), transparent);
  opacity:.55;
}

/*********** –ë–õ–ï–°–ö ***********/
#snowdrift .shine{
  position:absolute;
  top:0;
  left:-40%;
  width:40%;
  height:100%;
  background:linear-gradient(
    120deg,
    rgba(255,255,255,0) 0%,
    rgba(255,255,255,0.75) 50%,
    rgba(255,255,255,0) 100%
  );
  filter:blur(8px);
  animation:shineMove 6s linear infinite;
  pointer-events:none;
}

@keyframes shineMove{
  0%{left:-40%;}
  100%{left:120%;}
}

/*********** –ú–∏–Ω–∏-—Å–Ω–µ–∂–∫–∏ ***********/
.snowball{
  position:absolute;
  background:white;
  border-radius:50%;
  opacity:.92;
  filter:blur(.5px);
  pointer-events:none;
  z-index:7;
}
</style>
</head>
<body>

<!-- –°–£–ì–†–û–ë -->
<div id="snowdrift">
  <div class="shine"></div>
</div>

<div id="topWrap">
  <div id="message">üëÜ –ù–∞–∂–∏–º–∞–π, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫!</div>
  <div class="progress-wrap"><div id="bar" class="progress"></div></div>
</div>

<div id="slot">
  <img id="btn" loading="eager">
  <img id="gift" loading="lazy" alt="gift">
</div>

<div id="confirmBox">
  <p>–ü—Ä–æ–¥–∞—Ç—å –∏–ª–∏ –ø–æ–ª—É—á–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫?</p>
  <button id="sellBtn" class="confirm-btn">–ü–†–û–î–ê–¢–¨</button>
  <button id="receiveBtn" class="confirm-btn">–ü–û–õ–£–ß–ò–¢–¨</button>
</div>

<script>
/*********** ELEMENTS ***********/
const msg=document.getElementById("message"),
      btn=document.getElementById("btn"),
      gift=document.getElementById("gift"),
      bar=document.getElementById("bar"),
      box=document.getElementById("confirmBox"),
      sell=document.getElementById("sellBtn"),
      recv=document.getElementById("receiveBtn"),
      prog=document.querySelector(".progress-wrap");

/*********** RANDOM ASSETS ***********/
const backgrounds=["fon1.jpg","fon2.jpg"];
const btns=["btn1.webp","btn2.webp"];
const gifts=Array.from({length:10},(_,i)=>`g${i+1}.webp`);

function randomFloat(){
  try{
    if(crypto.getRandomValues){
      const a=new Uint32Array(1);
      crypto.getRandomValues(a);
      return a[0]/4294967296;
    }
  }catch(e){}
  return Math.random();
}

const randomBg=backgrounds[Math.floor(randomFloat()*backgrounds.length)];
const randomBtn=btns[Math.floor(randomFloat()*btns.length)];
const randomGift=gifts[Math.floor(randomFloat()*gifts.length)];
const randomAnim=Math.random()<0.5?"L1.webp":"L2.webp";

document.body.style.background=`#000 url('${randomBg}') center/cover no-repeat`;
btn.src=randomBtn;

/* preload */
[randomBg,randomBtn,randomGift,randomAnim].forEach(src=>{
  fetch(src).then(r=>r.blob()).then(b=>createImageBitmap(b)).catch(()=>{});
});

/*********** GAME ***********/
let taps=0,total=5,started=false;

btn.addEventListener("click",tap);

function tap(){
  btn.style.animation="tapPop .18s ease";
  setTimeout(()=>btn.style.animation="",180);

  if(!started){
    started=true;
    msg.style.opacity=0;
    prog.style.opacity=0;
  }

  taps++;
  bar.style.width=(taps/total*100)+"%";

  if(taps===total) revealGift();
}

function revealGift(){
  btn.style.opacity=0;
  btn.style.pointerEvents="none";
  setTimeout(()=>btn.style.display="none",200);
  prog.style.display="none";

  const img=new Image();
  img.src=randomGift;
  img.onload=()=>{
    gift.src=randomGift;
    const special=['g9.webp','g16.webp','g18.webp'];
    if(special.includes(randomGift)){
      gift.style.background='rgba(255,255,255,0.12)';
      gift.style.borderRadius='18px';
      gift.style.padding='8px';
    }else{
      gift.style.background='none';
      gift.style.padding='0';
    }
    gift.style.opacity=1;
    gift.style.transform="scale(1)";
    gift.style.pointerEvents="auto";
    msg.style.opacity=1;
    msg.textContent="üéÅ –¢–≤–æ–π –ø–æ–¥–∞—Ä–æ–∫ –≥–æ—Ç–æ–≤!";
  };
}

gift.onclick=()=>box.classList.add("show");
sell.onclick=()=>finish("sell");
recv.onclick=()=>finish("add");

function finish(type){
  box.classList.remove("show");
  gift.style.opacity=0;
  gift.style.transform="scale(.75)";
  setTimeout(()=>gift.style.display="none",150);

  msg.style.fontSize="1.4rem";
  msg.innerText = type==="sell"
    ?"üí∞ –ó–≤–µ–∑–¥—ã —Å–∫–æ—Ä–æ –±—É–¥—É—Ç –∑–∞—á–∏—Å–ª–µ–Ω—ã ‚ú®\n‚≠ê –í–æ–∑–≤—Ä–∞—â–∞–π—Å—è –∑–∞–≤—Ç—Ä–∞ –∑–∞ –Ω–∞–≥—Ä–∞–¥–∞–º–∏!"
    :"üéÅ –ü–æ–¥–∞—Ä–æ–∫ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –ø—Ä–æ—Ñ–∏–ª—å üéâ\n‚ú® –ü—Ä–∏—Ö–æ–¥–∏ –∑–∞–≤—Ç—Ä–∞ –∑–∞ –Ω–æ–≤—ã–º!";

  const anim=document.createElement("img");
  anim.src=randomAnim;
  Object.assign(anim.style,{
    position:"absolute",left:"50%",top:"50%",
    transform:"translate(-50%,-50%)",
    width:"55vw",maxWidth:"270px",opacity:0,
    transition:"opacity 0.4s ease",pointerEvents:"none",zIndex:"10"
  });
  document.body.appendChild(anim);
  requestAnimationFrame(()=>anim.style.opacity=1);
}

/*********** –°–ù–ï–ì–û–ü–ê–î ***********/
const snowIcons=["‚ùÑ","‚ú¶","‚úß","‚ú∫","‚úº"];
function createSnow(){
  const s=document.createElement("div");
  s.className="snowflake";
  s.textContent=snowIcons[Math.floor(Math.random()*snowIcons.length)];
  s.style.left=Math.random()*100+"vw";
  s.style.fontSize=12+Math.random()*20+"px";
  s.style.animationDuration=4+Math.random()*6+"s";
  document.body.appendChild(s);
  setTimeout(()=>s.remove(),10000);
}
setInterval(createSnow,60);

/*********** –°–£–ì–†–û–ë –†–ê–°–¢–Å–¢ ***********/
const drift=document.getElementById("snowdrift");
let driftHeight=0, driftTimer=0;

const driftInterval=setInterval(()=>{
  driftTimer+=1;
  driftHeight=Math.min(22, driftTimer*(22/15));
  drift.style.height=driftHeight+"vh";

  if(driftHeight>=22){
    clearInterval(driftInterval);
    spawnMiniSnow();
  }
},1000);

/*********** –ú–ò–ù–ò-–°–ù–ï–ñ–ö–ò ***********/
function spawnMiniSnow(){
  for(let i=0;i<22;i++){
    const ball=document.createElement("div");
    ball.className="snowball";
    const size=3+Math.random()*6;
    ball.style.width=size+"px";
    ball.style.height=size+"px";
    ball.style.left=Math.random()*100+"vw";
    ball.style.bottom=(0+Math.random()*18)+"px";
    document.body.appendChild(ball);
  }
}
</script>
</body>
</html>
